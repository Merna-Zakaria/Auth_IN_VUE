{"ast":null,"code":"import _regeneratorRuntime from \"/home/merna-zakaria/projects/self-learning-projects/vue_register_project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _createForOfIteratorHelper from \"/home/merna-zakaria/projects/self-learning-projects/vue_register_project/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _asyncToGenerator from \"/home/merna-zakaria/projects/self-learning-projects/vue_register_project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.find.js\";\n// Utilities\nimport { computed, inject, provide, ref, toRef, watch } from 'vue';\nimport { useProxiedModel } from \"./proxiedModel.mjs\";\nimport { consoleWarn, propsFactory } from \"../util/index.mjs\"; // Types\nexport var FormKey = Symbol[\"for\"]('vuetify:form');\nexport var makeFormProps = propsFactory({\n  disabled: Boolean,\n  fastFail: Boolean,\n  lazyValidation: Boolean,\n  readonly: Boolean,\n  modelValue: {\n    type: Boolean,\n    \"default\": null\n  },\n  validateOn: {\n    type: String,\n    \"default\": 'input'\n  }\n}, 'form');\nexport function createForm(props) {\n  var model = useProxiedModel(props, 'modelValue');\n  var isDisabled = computed(function () {\n    return props.disabled;\n  });\n  var isReadonly = computed(function () {\n    return props.readonly;\n  });\n  var isValidating = ref(false);\n  var items = ref([]);\n  var errors = ref([]);\n  function validate() {\n    return _validate.apply(this, arguments);\n  }\n  function _validate() {\n    _validate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var results, valid, _iterator2, _step2, item, itemErrorMessages;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              results = [];\n              valid = true;\n              errors.value = [];\n              isValidating.value = true;\n              _iterator2 = _createForOfIteratorHelper(items.value);\n              _context.prev = 5;\n              _iterator2.s();\n            case 7:\n              if ((_step2 = _iterator2.n()).done) {\n                _context.next = 17;\n                break;\n              }\n              item = _step2.value;\n              _context.next = 11;\n              return item.validate();\n            case 11:\n              itemErrorMessages = _context.sent;\n              if (itemErrorMessages.length > 0) {\n                valid = false;\n                results.push({\n                  id: item.id,\n                  errorMessages: itemErrorMessages\n                });\n              }\n              if (!(!valid && props.fastFail)) {\n                _context.next = 15;\n                break;\n              }\n              return _context.abrupt(\"break\", 17);\n            case 15:\n              _context.next = 7;\n              break;\n            case 17:\n              _context.next = 22;\n              break;\n            case 19:\n              _context.prev = 19;\n              _context.t0 = _context[\"catch\"](5);\n              _iterator2.e(_context.t0);\n            case 22:\n              _context.prev = 22;\n              _iterator2.f();\n              return _context.finish(22);\n            case 25:\n              errors.value = results;\n              isValidating.value = false;\n              return _context.abrupt(\"return\", {\n                valid: valid,\n                errors: errors.value\n              });\n            case 28:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[5, 19, 22, 25]]);\n    }));\n    return _validate.apply(this, arguments);\n  }\n  function reset() {\n    items.value.forEach(function (item) {\n      return item.reset();\n    });\n    model.value = null;\n  }\n  function resetValidation() {\n    items.value.forEach(function (item) {\n      return item.resetValidation();\n    });\n    errors.value = [];\n    model.value = null;\n  }\n  watch(items, function () {\n    var valid = 0;\n    var invalid = 0;\n    var results = [];\n    var _iterator = _createForOfIteratorHelper(items.value),\n      _step;\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var item = _step.value;\n        if (item.isValid === false) {\n          invalid++;\n          results.push({\n            id: item.id,\n            errorMessages: item.errorMessages\n          });\n        } else if (item.isValid === true) valid++;\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n    errors.value = results;\n    model.value = invalid > 0 ? false : valid === items.value.length ? true : null;\n  }, {\n    deep: true\n  });\n  provide(FormKey, {\n    register: function register(_ref) {\n      var id = _ref.id,\n        validate = _ref.validate,\n        reset = _ref.reset,\n        resetValidation = _ref.resetValidation;\n      if (items.value.some(function (item) {\n        return item.id === id;\n      })) {\n        consoleWarn(\"Duplicate input name \\\"\".concat(id, \"\\\"\"));\n      }\n      items.value.push({\n        id: id,\n        validate: validate,\n        reset: reset,\n        resetValidation: resetValidation,\n        isValid: null,\n        errorMessages: []\n      });\n    },\n    unregister: function unregister(id) {\n      items.value = items.value.filter(function (item) {\n        return item.id !== id;\n      });\n    },\n    update: function update(id, isValid, errorMessages) {\n      var found = items.value.find(function (item) {\n        return item.id === id;\n      });\n      if (!found) return;\n      found.isValid = isValid;\n      found.errorMessages = errorMessages;\n    },\n    isDisabled: isDisabled,\n    isReadonly: isReadonly,\n    isValidating: isValidating,\n    items: items,\n    validateOn: toRef(props, 'validateOn')\n  });\n  return {\n    errors: errors,\n    isDisabled: isDisabled,\n    isReadonly: isReadonly,\n    isValidating: isValidating,\n    items: items,\n    validate: validate,\n    reset: reset,\n    resetValidation: resetValidation\n  };\n}\nexport function useForm() {\n  return inject(FormKey, null);\n}","map":{"version":3,"mappings":";;;;;;;;;;;;AAAA;AACA,SAASA,QAAQ,EAAEC,MAAM,EAAEC,OAAO,EAAEC,GAAG,EAAEC,KAAK,EAAEC,KAAK,QAAQ,KAAK;AAAA,SACzDC,eAAe;AAAA,SACfC,WAAW,EAAEC,YAAY,6BAElC;AAyCA,OAAO,IAAMC,OAAkC,GAAGC,MAAM,OAAI,CAAC,cAAc,CAAC;AAW5E,OAAO,IAAMC,aAAa,GAAGH,YAAY,CAAC;EACxCI,QAAQ,EAAEC,OAAO;EACjBC,QAAQ,EAAED,OAAO;EACjBE,cAAc,EAAEF,OAAO;EACvBG,QAAQ,EAAEH,OAAO;EACjBI,UAAU,EAAE;IACVC,IAAI,EAAEL,OAAmC;IACzCM,WAAS;EACX,CAAC;EACDC,UAAU,EAAE;IACVF,IAAI,EAAEG,MAA2C;IACjDF,WAAS;EACX;AACF,CAAC,EAAE,MAAM,CAAC;AAEV,OAAO,SAASG,UAAU,CAAEC,KAAgB,EAAE;EAC5C,IAAMC,KAAK,GAAGlB,eAAe,CAACiB,KAAK,EAAE,YAAY,CAAC;EAElD,IAAME,UAAU,GAAGzB,QAAQ,CAAC;IAAA,OAAMuB,KAAK,CAACX,QAAQ;EAAA,EAAC;EACjD,IAAMc,UAAU,GAAG1B,QAAQ,CAAC;IAAA,OAAMuB,KAAK,CAACP,QAAQ;EAAA,EAAC;EACjD,IAAMW,YAAY,GAAGxB,GAAG,CAAC,KAAK,CAAC;EAC/B,IAAMyB,KAAK,GAAGzB,GAAG,CAAc,EAAE,CAAC;EAClC,IAAM0B,MAAM,GAAG1B,GAAG,CAA0B,EAAE,CAAC;EAAA,SAEhC2B,QAAQ;IAAA;EAAA;EAAA;IAAA,uEAAvB;MAAA;MAAA;QAAA;UAAA;YAAA;cACQC,OAAO,GAAG,EAAE;cACdC,KAAK,GAAG,IAAI;cAEhBH,MAAM,CAACI,KAAK,GAAG,EAAE;cACjBN,YAAY,CAACM,KAAK,GAAG,IAAI;cAAA,wCAENL,KAAK,CAACK,KAAK;cAAA;cAAA;YAAA;cAAA;gBAAA;gBAAA;cAAA;cAAnBC,IAAI;cAAA;cAAA,OACmBA,IAAI,CAACJ,QAAQ,EAAE;YAAA;cAAzCK,iBAAiB;cAEvB,IAAIA,iBAAiB,CAACC,MAAM,GAAG,CAAC,EAAE;gBAChCJ,KAAK,GAAG,KAAK;gBAEbD,OAAO,CAACM,IAAI,CAAC;kBACXC,EAAE,EAAEJ,IAAI,CAACI,EAAE;kBACXC,aAAa,EAAEJ;gBACjB,CAAC,CAAC;cACJ;cAAA,MAEI,CAACH,KAAK,IAAIT,KAAK,CAACT,QAAQ;gBAAA;gBAAA;cAAA;cAAA;YAAA;cAAA;cAAA;YAAA;cAAA;cAAA;YAAA;cAAA;cAAA;cAAA;YAAA;cAAA;cAAA;cAAA;YAAA;cAG9Be,MAAM,CAACI,KAAK,GAAGF,OAAO;cACtBJ,YAAY,CAACM,KAAK,GAAG,KAAK;cAAA,iCAEnB;gBAAED,KAAK,EAALA,KAAK;gBAAEH,MAAM,EAAEA,MAAM,CAACI;cAAM,CAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CACxC;IAAA;EAAA;EAEA,SAASO,KAAK,GAAI;IAChBZ,KAAK,CAACK,KAAK,CAACQ,OAAO,CAACP,cAAI;MAAA,OAAIA,IAAI,CAACM,KAAK,EAAE;IAAA,EAAC;IACzChB,KAAK,CAACS,KAAK,GAAG,IAAI;EACpB;EAEA,SAASS,eAAe,GAAI;IAC1Bd,KAAK,CAACK,KAAK,CAACQ,OAAO,CAACP,cAAI;MAAA,OAAIA,IAAI,CAACQ,eAAe,EAAE;IAAA,EAAC;IACnDb,MAAM,CAACI,KAAK,GAAG,EAAE;IACjBT,KAAK,CAACS,KAAK,GAAG,IAAI;EACpB;EAEA5B,KAAK,CAACuB,KAAK,EAAE,YAAM;IACjB,IAAII,KAAK,GAAG,CAAC;IACb,IAAIW,OAAO,GAAG,CAAC;IACf,IAAMZ,OAAO,GAAG,EAAE;IAAA,2CAECH,KAAK,CAACK,KAAK;MAAA;IAAA;MAA9B,oDAAgC;QAAA,IAArBC,IAAI;QACb,IAAIA,IAAI,CAACU,OAAO,KAAK,KAAK,EAAE;UAC1BD,OAAO,EAAE;UACTZ,OAAO,CAACM,IAAI,CAAC;YACXC,EAAE,EAAEJ,IAAI,CAACI,EAAE;YACXC,aAAa,EAAEL,IAAI,CAACK;UACtB,CAAC,CAAC;QACJ,CAAC,MAAM,IAAIL,IAAI,CAACU,OAAO,KAAK,IAAI,EAAEZ,KAAK,EAAE;MAC3C;IAAA;MAAA;IAAA;MAAA;IAAA;IAEAH,MAAM,CAACI,KAAK,GAAGF,OAAO;IACtBP,KAAK,CAACS,KAAK,GACTU,OAAO,GAAG,CAAC,GAAG,KAAK,GACjBX,KAAK,KAAKJ,KAAK,CAACK,KAAK,CAACG,MAAM,GAAG,IAAI,GACnC,IAAI;EACV,CAAC,EAAE;IAAES,IAAI,EAAE;EAAK,CAAC,CAAC;EAElB3C,OAAO,CAACO,OAAO,EAAE;IACfqC,QAAQ,EAAE,wBAA8C;MAAA,IAA3CR,EAAE,GAAoCS,KAAtCT,EAAE;QAAER,QAAQ,GAA0BiB,KAAlCjB,QAAQ;QAAEU,KAAK,GAAmBO,KAAxBP,KAAK;QAAEE,kBAAiBK,KAAjBL;MAChC,IAAId,KAAK,CAACK,KAAK,CAACe,IAAI,CAACd,cAAI;QAAA,OAAIA,IAAI,CAACI,EAAE,KAAKA,EAAE;MAAA,EAAC,EAAE;QAC5C/B,WAAW,kCAA0B+B,EAAG,QAAG;MAC7C;MAEAV,KAAK,CAACK,KAAK,CAACI,IAAI,CAAC;QACfC,EAAE,EAAFA,EAAE;QACFR,QAAQ,EAARA,QAAQ;QACRU,KAAK,EAALA,KAAK;QACLE,eAAe,EAAfA,eAAe;QACfE,OAAO,EAAE,IAAI;QACbL,aAAa,EAAE;MACjB,CAAC,CAAC;IACJ,CAAC;IACDU,UAAU,EAAEX,sBAAE,EAAI;MAChBV,KAAK,CAACK,KAAK,GAAGL,KAAK,CAACK,KAAK,CAACiB,MAAM,CAAChB,cAAI,EAAI;QACvC,OAAOA,IAAI,CAACI,EAAE,KAAKA,EAAE;MACvB,CAAC,CAAC;IACJ,CAAC;IACDa,MAAM,EAAE,gBAACb,EAAE,EAAEM,OAAO,EAAEL,aAAa,EAAK;MACtC,IAAMa,KAAK,GAAGxB,KAAK,CAACK,KAAK,CAACoB,IAAI,CAACnB,cAAI;QAAA,OAAIA,IAAI,CAACI,EAAE,KAAKA,EAAE;MAAA,EAAC;MAEtD,IAAI,CAACc,KAAK,EAAE;MAEZA,KAAK,CAACR,OAAO,GAAGA,OAAO;MACvBQ,KAAK,CAACb,aAAa,GAAGA,aAAa;IACrC,CAAC;IACDd,UAAU,EAAVA,UAAU;IACVC,UAAU,EAAVA,UAAU;IACVC,YAAY,EAAZA,YAAY;IACZC,KAAK,EAALA,KAAK;IACLR,UAAU,EAAEhB,KAAK,CAACmB,KAAK,EAAE,YAAY;EACvC,CAAC,CAAC;EAEF,OAAO;IACLM,MAAM,EAANA,MAAM;IACNJ,UAAU,EAAVA,UAAU;IACVC,UAAU,EAAVA,UAAU;IACVC,YAAY,EAAZA,YAAY;IACZC,KAAK,EAALA,KAAK;IACLE,QAAQ,EAARA,QAAQ;IACRU,KAAK,EAALA,KAAK;IACLE;EACF,CAAC;AACH;AAEA,OAAO,SAASY,OAAO,GAAI;EACzB,OAAOrD,MAAM,CAACQ,OAAO,EAAE,IAAI,CAAC;AAC9B","names":["computed","inject","provide","ref","toRef","watch","useProxiedModel","consoleWarn","propsFactory","FormKey","Symbol","makeFormProps","disabled","Boolean","fastFail","lazyValidation","readonly","modelValue","type","default","validateOn","String","createForm","props","model","isDisabled","isReadonly","isValidating","items","errors","validate","results","valid","value","item","itemErrorMessages","length","push","id","errorMessages","reset","forEach","resetValidation","invalid","isValid","deep","register","_ref","some","unregister","filter","update","found","find","useForm"],"sources":["../../src/composables/form.ts"],"sourcesContent":["// Utilities\nimport { computed, inject, provide, ref, toRef, watch } from 'vue'\nimport { useProxiedModel } from '@/composables/proxiedModel'\nimport { consoleWarn, propsFactory } from '@/util'\n\n// Types\nimport type { ComputedRef, InjectionKey, PropType, Ref } from 'vue'\nimport type { ValidationProps } from './validation'\n\nexport interface FormProvide {\n  register: (item: {\n    id: number | string\n    validate: () => Promise<string[]>\n    reset: () => void\n    resetValidation: () => void\n  }) => void\n  unregister: (id: number | string) => void\n  update: (id: number | string, isValid: boolean | null, errorMessages: string[]) => void\n  items: Ref<FormField[]>\n  isDisabled: ComputedRef<boolean>\n  isReadonly: ComputedRef<boolean>\n  isValidating: Ref<boolean>\n  validateOn: Ref<FormProps['validateOn']>\n}\n\ninterface FormField {\n  id: number | string\n  validate: () => Promise<string[]>\n  reset: () => void\n  resetValidation: () => void\n  isValid: boolean | null\n  errorMessages: string[]\n}\n\ninterface FieldValidationResult {\n  id: number | string\n  errorMessages: string[]\n}\n\ninterface FormValidationResult {\n  valid: boolean\n  errors: FieldValidationResult[]\n}\n\nexport interface SubmitEventPromise extends SubmitEvent, Promise<FormValidationResult> {}\n\nexport const FormKey: InjectionKey<FormProvide> = Symbol.for('vuetify:form')\n\nexport interface FormProps {\n  disabled: boolean\n  fastFail: boolean\n  readonly: boolean\n  modelValue: boolean | null\n  'onUpdate:modelValue': ((val: boolean | null) => void) | undefined\n  validateOn: ValidationProps['validateOn']\n}\n\nexport const makeFormProps = propsFactory({\n  disabled: Boolean,\n  fastFail: Boolean,\n  lazyValidation: Boolean,\n  readonly: Boolean,\n  modelValue: {\n    type: Boolean as PropType<boolean | null>,\n    default: null,\n  },\n  validateOn: {\n    type: String as PropType<FormProps['validateOn']>,\n    default: 'input',\n  },\n}, 'form')\n\nexport function createForm (props: FormProps) {\n  const model = useProxiedModel(props, 'modelValue')\n\n  const isDisabled = computed(() => props.disabled)\n  const isReadonly = computed(() => props.readonly)\n  const isValidating = ref(false)\n  const items = ref<FormField[]>([])\n  const errors = ref<FieldValidationResult[]>([])\n\n  async function validate () {\n    const results = []\n    let valid = true\n\n    errors.value = []\n    isValidating.value = true\n\n    for (const item of items.value) {\n      const itemErrorMessages = await item.validate()\n\n      if (itemErrorMessages.length > 0) {\n        valid = false\n\n        results.push({\n          id: item.id,\n          errorMessages: itemErrorMessages,\n        })\n      }\n\n      if (!valid && props.fastFail) break\n    }\n\n    errors.value = results\n    isValidating.value = false\n\n    return { valid, errors: errors.value }\n  }\n\n  function reset () {\n    items.value.forEach(item => item.reset())\n    model.value = null\n  }\n\n  function resetValidation () {\n    items.value.forEach(item => item.resetValidation())\n    errors.value = []\n    model.value = null\n  }\n\n  watch(items, () => {\n    let valid = 0\n    let invalid = 0\n    const results = []\n\n    for (const item of items.value) {\n      if (item.isValid === false) {\n        invalid++\n        results.push({\n          id: item.id,\n          errorMessages: item.errorMessages,\n        })\n      } else if (item.isValid === true) valid++\n    }\n\n    errors.value = results\n    model.value =\n      invalid > 0 ? false\n      : valid === items.value.length ? true\n      : null\n  }, { deep: true })\n\n  provide(FormKey, {\n    register: ({ id, validate, reset, resetValidation }) => {\n      if (items.value.some(item => item.id === id)) {\n        consoleWarn(`Duplicate input name \"${id}\"`)\n      }\n\n      items.value.push({\n        id,\n        validate,\n        reset,\n        resetValidation,\n        isValid: null,\n        errorMessages: [],\n      })\n    },\n    unregister: id => {\n      items.value = items.value.filter(item => {\n        return item.id !== id\n      })\n    },\n    update: (id, isValid, errorMessages) => {\n      const found = items.value.find(item => item.id === id)\n\n      if (!found) return\n\n      found.isValid = isValid\n      found.errorMessages = errorMessages\n    },\n    isDisabled,\n    isReadonly,\n    isValidating,\n    items,\n    validateOn: toRef(props, 'validateOn'),\n  })\n\n  return {\n    errors,\n    isDisabled,\n    isReadonly,\n    isValidating,\n    items,\n    validate,\n    reset,\n    resetValidation,\n  }\n}\n\nexport function useForm () {\n  return inject(FormKey, null)\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}