{"ast":null,"code":"import _objectSpread from \"/home/merna-zakaria/projects/self-learning-projects/vue_register_project/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _createForOfIteratorHelper from \"/home/merna-zakaria/projects/self-learning-projects/vue_register_project/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _typeof from \"/home/merna-zakaria/projects/self-learning-projects/vue_register_project/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport \"core-js/modules/es.array.index-of.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.map.js\";\n/* eslint-disable max-statements */\n/* eslint-disable no-labels */\n// Utilities\nimport { getPropertyFromItem, propsFactory, wrapInArray } from \"../util/index.mjs\";\nimport { computed, unref } from 'vue';\n\n// Types\n\n// Composables\nexport var defaultFilter = function defaultFilter(value, query, item) {\n  if (value == null || query == null) return -1;\n  return value.toString().toLocaleLowerCase().indexOf(query.toString().toLocaleLowerCase());\n};\nexport var makeFilterProps = propsFactory({\n  customFilter: Function,\n  customKeyFilter: Object,\n  filterKeys: [Array, String],\n  filterMode: {\n    type: String,\n    \"default\": 'intersection'\n  },\n  noFilter: Boolean\n}, 'filter');\nexport function filterItems(items, query, options) {\n  var _ref2, _ref3;\n  var array = [];\n  // always ensure we fall back to a functioning filter\n  var filter = (_ref2 = options == null ? void 0 : options[\"default\"]) !== null && _ref2 !== void 0 ? _ref2 : defaultFilter;\n  var keys = options != null && options.filterKeys ? wrapInArray(options.filterKeys) : false;\n  var customFiltersLength = Object.keys((_ref3 = options == null ? void 0 : options.customKeyFilter) !== null && _ref3 !== void 0 ? _ref3 : {}).length;\n  if (!(items != null && items.length)) return array;\n  loop: for (var i = 0; i < items.length; i++) {\n    var item = items[i];\n    var customMatches = {};\n    var defaultMatches = {};\n    var match = -1;\n    if (query && !(options != null && options.noFilter)) {\n      if (_typeof(item) === 'object') {\n        var filterKeys = keys || Object.keys(item);\n        var _iterator = _createForOfIteratorHelper(filterKeys),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var key = _step.value;\n            var _options$customKeyFil;\n            var value = getPropertyFromItem(item, key, item);\n            var keyFilter = options == null ? void 0 : (_options$customKeyFil = options.customKeyFilter) == null ? void 0 : _options$customKeyFil[key];\n            match = keyFilter ? keyFilter(value, query, item) : filter(value, query, item);\n            if (match !== -1 && match !== false) {\n              if (keyFilter) customMatches[key] = match;else defaultMatches[key] = match;\n            } else if ((options == null ? void 0 : options.filterMode) === 'every') {\n              continue loop;\n            }\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      } else {\n        match = filter(item, query, item);\n        if (match !== -1 && match !== false) {\n          defaultMatches.title = match;\n        }\n      }\n      var defaultMatchesLength = Object.keys(defaultMatches).length;\n      var customMatchesLength = Object.keys(customMatches).length;\n      if (!defaultMatchesLength && !customMatchesLength) continue;\n      if ((options == null ? void 0 : options.filterMode) === 'union' && customMatchesLength !== customFiltersLength && !defaultMatchesLength) continue;\n      if ((options == null ? void 0 : options.filterMode) === 'intersection' && (customMatchesLength !== customFiltersLength || !defaultMatchesLength)) continue;\n    }\n    array.push({\n      index: i,\n      matches: _objectSpread(_objectSpread({}, defaultMatches), customMatches)\n    });\n  }\n  return array;\n}\nexport function useFilter(props, items, query) {\n  var strQuery = computed(function () {\n    return typeof (query == null ? void 0 : query.value) !== 'string' && typeof (query == null ? void 0 : query.value) !== 'number' ? '' : String(query.value);\n  });\n  var filteredItems = computed(function () {\n    var transformedItems = unref(items);\n    var matches = filterItems(transformedItems, strQuery.value, {\n      customKeyFilter: props.customKeyFilter,\n      \"default\": props.customFilter,\n      filterKeys: props.filterKeys,\n      filterMode: props.filterMode,\n      noFilter: props.noFilter\n    });\n    return matches.map(function (_ref) {\n      var index = _ref.index,\n        matches = _ref.matches;\n      return {\n        item: transformedItems[index],\n        matches: matches\n      };\n    });\n  });\n  return {\n    filteredItems: filteredItems\n  };\n}","map":{"version":3,"mappings":"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","names":["getPropertyFromItem","propsFactory","wrapInArray","computed","unref","defaultFilter","value","query","item","toString","toLocaleLowerCase","indexOf","makeFilterProps","customFilter","Function","customKeyFilter","Object","filterKeys","Array","String","filterMode","type","default","noFilter","Boolean","filterItems","items","options","array","filter","keys","customFiltersLength","length","loop","i","customMatches","defaultMatches","match","key","keyFilter","_options$customKeyFil","title","defaultMatchesLength","customMatchesLength","push","index","matches","useFilter","props","strQuery","filteredItems","transformedItems","map","_ref"],"sources":["../../src/composables/filter.ts"],"sourcesContent":["/* eslint-disable max-statements */\n/* eslint-disable no-labels */\n\n// Utilities\nimport { getPropertyFromItem, propsFactory, wrapInArray } from '@/util'\nimport { computed, unref } from 'vue'\n\n// Types\nimport type { PropType, Ref } from 'vue'\nimport type { MaybeRef } from '@/util'\nimport type { InternalItem } from './items'\n\n/**\n * - match without highlight\n * - single match (index), length already known\n * - single match (start, end)\n * - multiple matches (start, end), probably shouldn't overlap\n */\nexport type FilterMatch = boolean | number | [number, number] | [number, number][]\nexport type FilterFunction = (value: string, query: string, item?: any) => FilterMatch\nexport type FilterKeyFunctions = Record<string, FilterFunction>\nexport type FilterKeys = string | string[]\nexport type FilterMode = 'some' | 'every' | 'union' | 'intersection'\n\nexport interface FilterProps {\n  customFilter?: FilterFunction\n  customKeyFilter?: FilterKeyFunctions\n  filterKeys?: FilterKeys\n  filterMode?: FilterMode\n  noFilter?: boolean\n}\n\n// Composables\nexport const defaultFilter: FilterFunction = (value, query, item) => {\n  if (value == null || query == null) return -1\n\n  return value.toString().toLocaleLowerCase().indexOf(query.toString().toLocaleLowerCase())\n}\n\nexport const makeFilterProps = propsFactory({\n  customFilter: Function as PropType<FilterFunction>,\n  customKeyFilter: Object as PropType<FilterKeyFunctions>,\n  filterKeys: [Array, String] as PropType<FilterKeys>,\n  filterMode: {\n    type: String as PropType<FilterMode>,\n    default: 'intersection',\n  },\n  noFilter: Boolean,\n}, 'filter')\n\nexport function filterItems (\n  items: any[],\n  query: string,\n  options?: {\n    customKeyFilter?: FilterKeyFunctions\n    default?: FilterFunction\n    filterKeys?: FilterKeys\n    filterMode?: FilterMode\n    noFilter?: boolean\n  },\n) {\n  const array: { index: number, matches: Record<string, FilterMatch> }[] = []\n  // always ensure we fall back to a functioning filter\n  const filter = options?.default ?? defaultFilter\n  const keys = options?.filterKeys ? wrapInArray(options.filterKeys) : false\n  const customFiltersLength = Object.keys(options?.customKeyFilter ?? {}).length\n\n  if (!items?.length) return array\n\n  loop:\n  for (let i = 0; i < items.length; i++) {\n    const item = items[i]\n    const customMatches: Record<string, FilterMatch> = {}\n    const defaultMatches: Record<string, FilterMatch> = {}\n    let match: FilterMatch = -1\n\n    if (query && !options?.noFilter) {\n      if (typeof item === 'object') {\n        const filterKeys = keys || Object.keys(item)\n\n        for (const key of filterKeys) {\n          const value = getPropertyFromItem(item as any, key, item)\n          const keyFilter = options?.customKeyFilter?.[key]\n\n          match = keyFilter\n            ? keyFilter(value, query, item)\n            : filter(value, query, item)\n\n          if (match !== -1 && match !== false) {\n            if (keyFilter) customMatches[key] = match\n            else defaultMatches[key] = match\n          } else if (options?.filterMode === 'every') {\n            continue loop\n          }\n        }\n      } else {\n        match = filter(item, query, item)\n        if (match !== -1 && match !== false) {\n          defaultMatches.title = match\n        }\n      }\n\n      const defaultMatchesLength = Object.keys(defaultMatches).length\n      const customMatchesLength = Object.keys(customMatches).length\n\n      if (!defaultMatchesLength && !customMatchesLength) continue\n\n      if (\n        options?.filterMode === 'union' &&\n        customMatchesLength !== customFiltersLength &&\n        !defaultMatchesLength\n      ) continue\n\n      if (\n        options?.filterMode === 'intersection' &&\n        (\n          customMatchesLength !== customFiltersLength ||\n          !defaultMatchesLength\n        )\n      ) continue\n    }\n\n    array.push({ index: i, matches: { ...defaultMatches, ...customMatches } })\n  }\n\n  return array\n}\n\nexport function useFilter (\n  props: FilterProps,\n  items: MaybeRef<InternalItem[]>,\n  query?: Ref<string | undefined>,\n) {\n  const strQuery = computed(() => (\n    typeof query?.value !== 'string' &&\n    typeof query?.value !== 'number'\n  ) ? '' : String(query.value))\n\n  const filteredItems = computed(() => {\n    const transformedItems = unref(items)\n    const matches = filterItems(\n      transformedItems,\n      strQuery.value,\n      {\n        customKeyFilter: props.customKeyFilter,\n        default: props.customFilter,\n        filterKeys: props.filterKeys,\n        filterMode: props.filterMode,\n        noFilter: props.noFilter,\n      },\n    )\n\n    return matches.map(({ index, matches }) => ({\n      item: transformedItems[index],\n      matches,\n    }))\n  })\n\n  return { filteredItems }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}